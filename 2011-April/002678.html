<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Kiwi-users] Can't set permissions for user to write to fat	partition
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/kiwi-users/2011-April/index.html" >
   <LINK REL="made" HREF="mailto:kiwi-users%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-users%5D%20Can%27t%20set%20permissions%20for%20user%20to%20write%20to%20fat%0A%09partition&In-Reply-To=%3CBANLkTi%3DzNsS90RwRBHEqF09Te4D5DiHm7w%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002675.html">
   <LINK REL="Next"  HREF="002683.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Kiwi-users] Can't set permissions for user to write to fat	partition</H1>
    <B>Chris Cunha</B> 
    <A HREF="mailto:kiwi-users%40lists.berlios.de?Subject=Re%3A%20%5BKiwi-users%5D%20Can%27t%20set%20permissions%20for%20user%20to%20write%20to%20fat%0A%09partition&In-Reply-To=%3CBANLkTi%3DzNsS90RwRBHEqF09Te4D5DiHm7w%40mail.gmail.com%3E"
       TITLE="[Kiwi-users] Can't set permissions for user to write to fat	partition">eportel6607 at gmail.com
       </A><BR>
    <I>Fri Apr 22 03:19:21 CEST 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="002675.html">[Kiwi-users] Can't set permissions for user to write to fat	partition
</A></li>
        <LI>Next message: <A HREF="002683.html">[Kiwi-users] Can't set permissions for user to write to fat	partition
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2678">[ date ]</a>
              <a href="thread.html#2678">[ thread ]</a>
              <a href="subject.html#2678">[ subject ]</a>
              <a href="author.html#2678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Apr 21, 2011 at 4:33 PM, Chris Cunha &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">eportel6607 at gmail.com</A>&gt; wrote:
&gt;<i> On Mon, Apr 18, 2011 at 4:39 PM, Robert Schweikert
</I>&gt;<i> &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">rschweikert at novell.com</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 04/18/2011 04:30 PM, Chris Cunha wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Mon, Apr 18, 2011 at 2:03 PM, Robert Schweikert
</I>&gt;&gt;&gt;<i> &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">rschweikert at novell.com</A>&gt; &#160;wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Hi Chris,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On 04/18/2011 12:44 PM, Chris Cunha wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> On Mon, Apr 18, 2011 at 4:27 AM, Marcus Sch&#228;fer&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">ms at suse.de</A>&gt; &#160; &#160;wrote:
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Hi
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> I've been doing the majority of my devel work on my live usb image as
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> root. &#160;I'm am now ready to set all the permissions for a user. &#160;I have
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> been unsuccessful to change the permissions on the mounted directory
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> to allow a user to write/read from it. &#160;Even manually setting the
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> permission does not work. &#160;Although there is no error when the command
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> is executed the permissions.
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> Marcus helped me with a script that looks for the fat partition an
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> mounts this partition. &#160;This partition mounts to a folder in / file
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> tree. &#160;Inside this folder is a bunch of system files and folder such
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> as &quot;boot&quot; and other config files. &#160;Also in this folder is a storage
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> folder. It is this folder that I would like to change the permissions
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> for and everything inside this folder. &#160;Robert gave me a few tips to
</I>&gt;&gt;&gt;&gt;&gt;&gt;&gt;<i> look at regarding mounting rules but nothing seem to worked.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> Are you talking about the permissions on the fat filesystem ?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> No,
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Marcus, Chris has issues with the way the file system is mounted, i.e.
</I>&gt;&gt;&gt;&gt;<i> user
</I>&gt;&gt;&gt;&gt;<i> X cannot write to the mounted file system, irregardless of file
</I>&gt;&gt;&gt;&gt;<i> ownership.
</I>&gt;&gt;&gt;&gt;<i> Based on the description, I take it that the FAT partition gets mounted
</I>&gt;&gt;&gt;&gt;<i> as
</I>&gt;&gt;&gt;&gt;<i> read only for user and read/write for root. Therefore, I suggested that
</I>&gt;&gt;&gt;&gt;<i> Chris take a look at the auto-mounting setup. Auto-mounting, to the best
</I>&gt;&gt;&gt;&gt;<i> of
</I>&gt;&gt;&gt;&gt;<i> my knowledge has two components. One component is formed by udev and the
</I>&gt;&gt;&gt;&gt;<i> udev-rules. The other component is buried in the given desktop
</I>&gt;&gt;&gt;&gt;<i> environment.
</I>&gt;&gt;&gt;&gt;<i> I know that for both KDE and GNOME one can disable auto-mounting of
</I>&gt;&gt;&gt;&gt;<i> devices
</I>&gt;&gt;&gt;&gt;<i> or set rules how devices are mounted. I suspect something similar exists
</I>&gt;&gt;&gt;&gt;<i> for
</I>&gt;&gt;&gt;&gt;<i> LXDE, but I am not familiar with LXDE.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i> if so fat doesn't have the user bits other filesystems have.
</I>&gt;&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> &lt;snip&gt;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Hi Marcus.
</I>&gt;&gt;&gt;&gt;&gt;<i> I didn't know that. &#160;So this OS will have to be run as root in live
</I>&gt;&gt;&gt;&gt;&gt;<i> mode because the user will never be able to write to the storage
</I>&gt;&gt;&gt;&gt;&gt;<i> folders on the fat partition, correct?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> No, think of the FAT partition as a stick in and of itself. If you go out
</I>&gt;&gt;&gt;&gt;<i> and buy a new stick it is usually formatted with a FAT partition since
</I>&gt;&gt;&gt;&gt;<i> every
</I>&gt;&gt;&gt;&gt;<i> computer can read/write to this format. If you plug this new stick into
</I>&gt;&gt;&gt;&gt;<i> your
</I>&gt;&gt;&gt;&gt;<i> Linux box it will get mounted and the user for which the stick got
</I>&gt;&gt;&gt;&gt;<i> auto-mounted will be able to rad/write to the stick. However, if you list
</I>&gt;&gt;&gt;&gt;<i> the file that got copied to the stick you will see that the permission
</I>&gt;&gt;&gt;&gt;<i> bits
</I>&gt;&gt;&gt;&gt;<i> of the file itself are not what you would expect from a Linux file
</I>&gt;&gt;&gt;&gt;<i> system.
</I>&gt;&gt;&gt;&gt;<i> This is because a FAT filesystem has no notion of owner/group/other
</I>&gt;&gt;&gt;&gt;<i> permission settings.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> See <A HREF="http://www.dartmouth.edu/~rc/help/faq/permissions.html">http://www.dartmouth.edu/~rc/help/faq/permissions.html</A> for a
</I>&gt;&gt;&gt;&gt;<i> refresher
</I>&gt;&gt;&gt;&gt;<i> on Unix filesystem permissions, and
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://technet.microsoft.com/en-us/library/cc783530%28WS.10%29.aspx">http://technet.microsoft.com/en-us/library/cc783530%28WS.10%29.aspx</A> for
</I>&gt;&gt;&gt;&gt;<i> permissions info on a FAT based filesystem.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> You are talking about the read/write permissions of the mounted file
</I>&gt;&gt;&gt;&gt;<i> system
</I>&gt;&gt;&gt;&gt;<i> while Marcus is pointing out that permissions on individual files on a
</I>&gt;&gt;&gt;&gt;<i> FAT
</I>&gt;&gt;&gt;&gt;<i> partition are different from the permissions on a Linux file system such
</I>&gt;&gt;&gt;&gt;<i> as
</I>&gt;&gt;&gt;&gt;<i> ext3, XFS, etc.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The two concepts, whether a user is allowed to read/write a mounted file
</I>&gt;&gt;&gt;&gt;<i> system or not, and whether file system content reflects proper
</I>&gt;&gt;&gt;&gt;<i> permissions
</I>&gt;&gt;&gt;&gt;<i> are only loosely related. For purposes of discussion these concepts need
</I>&gt;&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;&gt;<i> be clearly delineated to avoid confusion.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Anyway, in your case you have issues with the permissions of the mounted
</I>&gt;&gt;&gt;&gt;<i> filesystem, not with the permissions of any given file on the filesystem.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> HTH,
</I>&gt;&gt;&gt;&gt;<i> Robert
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;<i> Robert Schweikert &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; MAY THE SOURCE BE WITH YOU
</I>&gt;&gt;&gt;&gt;<i> Novell-IBM Software Integration Center &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;LINUX
</I>&gt;&gt;&gt;&gt;<i> Tech Lead
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">rschweikert at novell.com</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">rschweikert at ca.ibm.com</A>
</I>&gt;&gt;&gt;&gt;<i> 781-464-8147
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Novell
</I>&gt;&gt;&gt;&gt;<i> Making IT Work As One
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> Kiwi-users mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">Kiwi-users at lists.berlios.de</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">https://lists.berlios.de/mailman/listinfo/kiwi-users</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Yes that correct Robert...thanks for explaining the difference between the
</I>&gt;&gt;&gt;<i> two.
</I>&gt;&gt;&gt;<i> The weird thing is that if I plug another USB drive in the machine
</I>&gt;&gt;&gt;<i> (while it's running the live USB drive) I can write to that no problem
</I>&gt;&gt;&gt;<i> as a user. &#160;Why is this?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I suspect the stick is auto-mounted and the permissions for the mount is set
</I>&gt;&gt;<i> such that the user is allowed to write to the stick. You're FAT partition on
</I>&gt;&gt;<i> your image stick is mounted via script that is probably executed as root and
</I>&gt;&gt;<i> thus only root can write to the mounted filesystem.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But you cannot issue 'mount' as a user unless you have an entry in
</I>&gt;&gt;<i> /etc/fstab that allows the user to mount the filesystem. Thus in your script
</I>&gt;&gt;<i> that finds the FAT partition you could just modify /etc/fstab instead of
</I>&gt;&gt;<i> mounting the partition and then when the user gets logged in automatically
</I>&gt;&gt;<i> you run a script that mounts the FAT filesystem.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> HTH,
</I>&gt;&gt;<i> Robert
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> --
</I>&gt;&gt;<i> Robert Schweikert &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; MAY THE SOURCE BE WITH YOU
</I>&gt;&gt;<i> Novell-IBM Software Integration Center &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;LINUX
</I>&gt;&gt;<i> Tech Lead
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">rschweikert at novell.com</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">rschweikert at ca.ibm.com</A>
</I>&gt;&gt;<i> 781-464-8147
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Novell
</I>&gt;&gt;<i> Making IT Work As One
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Kiwi-users mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">Kiwi-users at lists.berlios.de</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/kiwi-users">https://lists.berlios.de/mailman/listinfo/kiwi-users</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks Robert.
</I>&gt;<i> I understand what's going on now thanks to your explanation.
</I>&gt;<i> So adding a line to my /etc/fstab like this &quot;/dev/sdb1 &#160; &#160; /SOS
</I>&gt;<i> vfat &#160; &#160; rw,auto,user&quot;
</I>&gt;<i> what that do it?
</I>&gt;<i>
</I>&gt;<i> I would have to modify the script that I have now that finds and
</I>&gt;<i> mounts the this fat partition so that it doesn't auto mount the fat
</I>&gt;<i> partition. &#160;Could I just change the fstab file to have this entry and
</I>&gt;<i> have the fat partition auto mounted using a script in maybe the
</I>&gt;<i> ~/.config/autostart or globally in the
</I>&gt;<i> /etc/init.rd/boot.local...actually I think this mount script would
</I>&gt;<i> have to trigger the mounting of the fat partition after login right?
</I>&gt;<i> c
</I>&gt;<i>
</I>
Robert and Marcus
Before I go crazy and waste a bunch of time I want to check with you guys first.

The goal now is to get everything working for a user and not just for
root.  So theses scripts need to run globally.
This is the script that runs when Root logs in (from the
/root/.config/autostart).  <A HREF="http://paste2.org/p/1377059">http://paste2.org/p/1377059</A>
This is the script that Marcus gave me to find and auto mount the fat
partition.  I have it mount this partition to &quot;/SOS&quot;
All of this works fine as Root but as Robert said, having this script
mount the partition using this script means that it mounts as Root.
As Robert suggested I've added a line in this script &quot;cat /etc/fstab |
sed -e 's-/dev/sdb1-'${bootdev}'-'&quot; and commented out the &quot;mount
${bootdev}1 /SOS&quot; line.

The /etc/fstab file looks like this  <A HREF="http://paste2.org/p/1377068">http://paste2.org/p/1377068</A>

I used the &quot;sed&quot; command to replace the &quot;/dev/sdb1&quot; in the fstab file
just encase the device is something different than &quot;/dev/sdb1&quot;.

After making this modification to the fstab file I was hoping to run a
script as the user (in ~/.config/autostart) to trigger the mounting of
this partition which should give the user read/write access to the fat
partition.

The things I'm concerned about is this script
(<A HREF="http://paste2.org/p/1377059">http://paste2.org/p/1377059</A>) needs to run globally, as the user
account will autologin.   So should I run this script from
/etc/init.d/boot.local?  I'm thinking &quot;no&quot; because any commands in the
/etc/init.d/boot.local script will run waaaay before any user logs in.
 This may be fine for the actual changing of the /etc/fstab file
section of the script but as you can see at the end of this script
(<A HREF="http://paste2.org/p/1377059">http://paste2.org/p/1377059</A>) there is another command at the bottom
that runs other important scripts to set permissions, create other
directories and change Windows attributes on some of the directories
being created.  My question is, will this happen in the correct
order/sequence?
I'm still not sure how SUSE runs things like this globally.  In my
other past projects there was a global autostart directory in
/usr/share/ so I never ran into any issues running scripts globally on
login.
C

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002675.html">[Kiwi-users] Can't set permissions for user to write to fat	partition
</A></li>
	<LI>Next message: <A HREF="002683.html">[Kiwi-users] Can't set permissions for user to write to fat	partition
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2678">[ date ]</a>
              <a href="thread.html#2678">[ thread ]</a>
              <a href="subject.html#2678">[ subject ]</a>
              <a href="author.html#2678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/kiwi-users">More information about the Kiwi-users
mailing list</a><br>
</body></html>
